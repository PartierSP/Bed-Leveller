' Gambas class file

Public Sub Form_Open()

  Dim sScrew As New String[10]

  SBX.Value = FMain.iBedSizeX - FMain.iMargin
  SBY.Value = FMain.iBedSizeY - FMain.iMargin
  SBZ.Value = FMain.fShim
  
  sScrew = ["M2.5 x 0.45", "M3 x 0.5", "M4 x 0.7", "M5 x 0.8", "M6 x 1", "#4-40 UNC", "#4-48 UNC", "#6-32 UNC", "#6-40 UNF", "#8-32 UNC", "#8-36 UNF", "#10-24 UNC", "#10-32 UNF", "1/4-20 UNC", "1/4-28 UNF"]
  CBScrew.List = sScrew

End

Public Sub BtnCancel_Click()

  Me.Close()

End

Public Sub BtnCalculate_Click()

  Dim fAns As Float
  
  fAns = (SBMeasured.Value - SBZ.Value) / 0.7 * SBDivPR.Value
  If fans > 0 Then 
    TBAns.Text = "Rotate Clockwise " & Round(Abs(FAns), -1) & " Divisions."
  Else 
    TBAns.Text = "Rotate Counter Clockwise " & Round(Abs(FAns), -1) & " Divisions."
  Endif
End


Public Sub BtnGenSTL_Click()

  Dim sSTL As String

  Dialog.Filter = ["*.stl", "STL 3D Models"]
  If Dialog.SaveFile() Then Return 
  sSTL = GenerateSTL()
  File.Save(Dialog.Path, sSTL)

'Catch 
'    Message.Error(Error.text)
End

Public Sub GenerateSTL() As String
  
  Dim sSTL As String
  Dim fsize As Float
  Dim fDirection As Float[]
  Dim X As Float
  Dim Y As Float
  Dim Z As Float
  Dim iSide As Integer
  Dim fHeight As Float

  fDirection = [0, 0.5, 0.5, 0.5, 0, 0.5, 0, -0.5, 0.5, -0.5, 0, 0.5, 0, 0, 0, 0, 0, 1]
  fSize = 10

  sSTL = "solid ascii\n"
  For iSide = 0 To 17 Step 3
    X = fDirection[iSide + 0] * fSize * 0.2
    Y = fDirection[iSide + 1] * fSize * 0.2
    Z = fDirection[iSide + 2] * fHeight * 0.2
    sSTL &= "  facet normal " & X & " " & Y & " " & Z & "\n"
    sSTL &= "    outer loop\n"
    sSTL &= "      vertex \n"
    sSTL &= "      vertex \n"
    sSTL &= "      vertex \n"
    sSTL &= "    endloop\n"
    sSTL &= "  endfacet\n"
  Next
  sstl &= "endsolid"

  Return sSTL

End
